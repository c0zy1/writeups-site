---
title: "Reverse Engineering the TL-WR841N - Part 1"
date: 2025-09-04 00:00:00 +0800
categories: [Router]
tags: [Reverse Engineering]
---

This 3-4 part series demonstrates some basic to moderately advanced techniques for analyzing an old TP-Link router in order to build an exemplary attack chain.

Part 1 - Reconnaissance

First, we start the router and then we login via default credentials to see which firmware image is running on this specific device.

![TP-Link](/assets/TPLink/tplinkinterface.png)
![TP-Link](/assets/TPLink/firmware.png)

Our second step is a basic Nmap service detection scan against the router to find exposed services running by default.

![TP-Link](/assets/TPLink/nmap.png)

After that, we start AttifyOS, a common IoT pentesting distribution that comes with many useful tools and is based on Ubuntu 22.04.

At this point, I had to do some digging because I wanted the network card of my laptop to supply my VM with Wi-Fi and separately connect the VM to the TP-Link router.

Luckily, i still had an old Edimax N150 adapter that i once bought to set up Tails OS, which did not work at the time.

I was facing the issue that the default driver for this device did not allow the adapter to connect and run properly so I manually had to switch the driver. 

The following part will be a tutorial on how to switch a driver while maintaining a solid amount of control and reliable checkpoints.

I already completed the setup, so your output may not match mine exactly.

Step 1 - VirtualBox settings

![TPLink](/assets/TPLink/vboxset.png)    
![TPLink](/assets/TPLink/usb.png)   

We need two network adapters, one for our regular wifi, the other one for the internal network with our target router.
We also need to tell VirtualBox that there is a USB device.

Step 2 - Inspecting the network interfaces

```bash
ip addr show
```

![TPLink](/assets/TPLink/ipaddr.png)   

Step 3 - Examinating the firmware/driver 

```bash
sudo dmesg | grep 8188
```

```bash
sudo iw dev wlx08beac41724f scan | grep SSID
``` 

![TPLink](/assets/TPLink/iwdev.png)  

Usually, the kernel staging driver is loaded and the iw dev command delivers no results because it is not working properly.

Step 4 - Installing an external driver, in this case from Aircrack-ng

```bash
git clone https://github.com/aircrack-ng/rtl8188eus.git
```

```bash
cd rtl8188eus
```

```bash
echo "blacklist r8188eu" | sudo tee /etc/modprobe.d/realtek.conf
```

```bash
make
```

```bash
sudo make install
```


Step 5 - Checking if our driver was loaded

```bash
lsmod | grep 8188    # was anything loaded?
```

```bash
modinfo 8188eu | grep filename  # what exact file in the specific library got loaded?
```

```bash
sudo dmesg | tail -n 30    # is there any confirmation from the kernel?
```


![TPLink](/assets/TPLink/lsmodinfo.png) 
![TPLink](/assets/TPLink/dmesg.png)   

Step 6 - removing the old module, loading the new one(if the old one is still loaded)

```bash
sudo modprobe -r 8188eu && sudo modprobe 8188eu
```
